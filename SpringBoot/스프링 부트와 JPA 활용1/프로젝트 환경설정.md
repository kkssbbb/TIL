# ëª©ì°¨
- ğŸ“Œí”„ë¡œì íŠ¸ ìƒì„±
- ğŸ“Œë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚´í´ë³´ê¸°
- ğŸ“ŒView í™˜ê²½ ì„¤ì •
- ğŸ“ŒH2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜
- ğŸ“ŒJPAì™€ DB ì„¤ì •, ë™ì‘í™•ì¸

<br>
<br>
<br>
<br>

# ğŸ“Œí”„ë¡œì íŠ¸ ìƒì„±
![í™˜ê²½ì„¤ì •](https://user-images.githubusercontent.com/89888075/169788287-b7ec384c-c2c0-4958-afa8-ad9dc24cac94.PNG)
~~~java
plugins {
	id 'org.springframework.boot' version '2.7.0'
	id 'io.spring.dependency-management' version '1.0.11.RELEASE'
	id 'java'
}

group = 'jpabook'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}

repositories {
	mavenCentral()
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	implementation 'org.springframework.boot:spring-boot-starter-validation'
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	compileOnly 'org.projectlombok:lombok'
	runtimeOnly 'com.h2database:h2'
	annotationProcessor 'org.projectlombok:lombok'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
//JUnit4 ì¶”ê°€
	testImplementation("org.junit.vintage:junit-vintage-engine") {
		exclude group: "org.hamcrest", module: "hamcrest-core"
	}
}
test {
	useJUnitPlatform()
}

~~~
<br>
<br>
<br>
<br>

# ğŸ“Œë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚´í´ë³´ê¸°
<br>
<br>

## ìŠ¤í”„ë§ë¶€íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
### spring-boot-starter-web
- spring-boot-starter-tomcat: í†°ìº£ (ì›¹ì„œë²„)
- spring-webmvc: ìŠ¤í”„ë§ ì›¹ MVC
### spring-boot-starter-thymeleaf: íƒ€ì„ë¦¬í”„ í…œí”Œë¦¿ ì—”ì§„(View)
### spring-boot-starter-data-jpa
- spring-boot-starter-aop
- spring-boot-starter-jdbc
  -  HikariCP ì»¤ë„¥ì…˜ í’€ (ë¶€íŠ¸ 2.0 ê¸°ë³¸)
- hibernate + JPA: í•˜ì´ë²„ë„¤ì´íŠ¸ + JPA
- spring-data-jpa: ìŠ¤í”„ë§ ë°ì´í„° JPA
### spring-boot-starter(ê³µí†µ): ìŠ¤í”„ë§ ë¶€íŠ¸ + ìŠ¤í”„ë§ ì½”ì–´ + ë¡œê¹…
- spring-boot
  - spring-core
- spring-boot-starter-logging
  - logback, slf4j

<br>
<br>

## í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
### spring-boot-starter-test
- junit: í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
- mockito: ëª© ë¼ì´ë¸ŒëŸ¬ë¦¬
- assertj: í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¢€ ë” í¸í•˜ê²Œ ì‘ì„±í•˜ê²Œ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- spring-test: ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸ ì§€ì›
### í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
- ìŠ¤í”„ë§ MVC
- ìŠ¤í”„ë§ ORM
- JPA, í•˜ì´ë²„ë„¤ì´íŠ¸
- ìŠ¤í”„ë§ ë°ì´í„° JPA
### ê¸°íƒ€ ë¼ì´ë¸ŒëŸ¬ë¦¬
- H2 ë°ì´í„°ë² ì´ìŠ¤ í´ë¼ì´ì–¸íŠ¸
- ì»¤ë„¥ì…˜ í’€: ë¶€íŠ¸ ê¸°ë³¸ì€ HikariCP
- WEB(thymeleaf)
- ë¡œê¹… SLF4J & LogBack
- í…ŒìŠ¤íŠ¸

<br>
<br>
<br>
<br>

# ğŸ“ŒView í™˜ê²½ ì„¤ì •
### devtools ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ 
~~~java
	implementation 'org.springframework.boot:spring-boot-devtools'
	//devtools ìŠ¤í”„ë§ ê°œë°œìë“¤ì—ê²Œ í¸ë¦¬í•œ ë„ë¥¼ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
~~~
<br>
<br>

## ğŸ”devtools ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ëŠ¥ë° íŠ¹ì§•
## ê¸°ëŠ¥
1. ì½”ë“œê°€ ë³€ê²½ë  ë•Œ ìë™ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¤ì‹œ ì‹œì‘
 
2. ë¸Œë¼ìš°ì €ë¡œ ì „ì†¡ë˜ëŠ” ë¦¬ì†ŒìŠ¤(í…œí”Œë¦¿,ìë°”ìŠ¤í¬ë¦½íŠ¸ë“±)ê°€ ë³€ê²½ë  ë•Œ ìë™ìœ¼ë¡œ ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨

3. í…œí”Œë¦¿ ìºì‹œë¥¼ ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”

4. H2 ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© ì‹œ ìë™ìœ¼ë¡œ H2ì½˜ì†” í™œì„±í™”

## íŠ¹ì§•
- ê°œë°œì‹œì—ë§Œ ì‚¬ìš©ë˜ë©° ì‹¤ì œ ìš´ì˜ì‹œ ìŠ¤ìŠ¤ë¡œ ë¹„í™œì„±í™” ì‹œí‚¤ëŠ” ì†ì„±ì´ ìˆìŒ
<br>
<br>
<br>

~~~java
package jpabook.jpashop;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HelloController {
    
    @GetMapping("hello")
    public String hello(Model model){
        model.addAttribute("test","hi");

        return "hello";
    }
}

~~~
<br>

## hello/html ìƒì„±
~~~html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>

<p th:text="'hiwe331233. ' + ${test}" >ì•ˆë…•í•˜ì„¸ìš”. ì†ë‹˜</p>
</body>
</html>
~~~
helloë¥¼ url ë¡œ ìš”ì²­ë°›ì„ì‹œ hello.htmlì„ ë¦¬í„´í•œë‹¤.

hello.html ê²½ë¡œëŠ” resources/templates/hello.html

![test](https://user-images.githubusercontent.com/89888075/170210715-e260eb62-e4a2-45a4-8416-3b8447200732.PNG)

<br>
<br>

## index.html ìƒì„±
~~~html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
Hello
<a href="/hello">hello</a>
</body>
</html>
~~~

![test2](https://user-images.githubusercontent.com/89888075/170210934-5fc6cee4-ddec-4a99-b850-e3face33d38a.PNG)

<br>
<br>
<br>
<br>

# ğŸ“ŒH2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜
H2 version 1.4.199 ë‹¤ìš´

<br>
<br>
<br>
<br>

# ğŸ“ŒJPAì™€ DB ì„¤ì •, ë™ì‘í™•ì¸
## application.yml
~~~yml
spring:
  datasource:
    url:  jdbc:h2:tcp://localhost/~/test
    username: sa
    driver-class-name: org.h2.Driver

  jpa:
    hibernate:
      ddl-auto: create # ì´ ì˜µì…˜ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— í…Œì´ë¸”ì„ drop í•˜ê³ , ë‹¤ì‹œ ìƒì„±í•œë‹¤.
    properties:
      hibernate:
   #     show_sql: true  ì‹œìŠ¤í…œì•„ì›ƒìœ¼ë¡œ sqlê¸°ë¡ ë‚¨ê¹€
        format_sql: true

logging:
  level:
    org.hibernate.sql: debug

    # show_sql : ì˜µì…˜ì€ System.out ì— í•˜ì´ë²„ë„¤ì´íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¸´ë‹¤.
    # org.hibernate.SQL : ì˜µì…˜ì€ loggerë¥¼ í†µí•´ í•˜ì´ë²„ë„¤ì´íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¸´ë‹¤

~~~
## Member
~~~java
package jpabook.jpashop;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity //jpa ê°ì²´ ë§µí•‘ JPAê°€ ê´€ë¦¬í•¨
@Getter @Setter //ë£¸ë¶
public class Member {

    @Id //jpa ê¸°ë³¸í‚¤ ë§µí•‘
    @GeneratedValue //ê¸°ë³¸í‚¤ ìë™ì„œìƒì„± ì „ëµ ì§ì ‘í• ë‹¹ì‹œ @Idë§Œ ì‚¬ìš©
    private Long id;
    private String username;

}
 /* JPA ë§µí•‘
   ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘ : @Entity,@Table
    ê¸°ë³¸ í‚¤ ë§¤í•‘ :@Id
    í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘ : @Column
    ì—°ê´€ê´€ê³„ ë§¤í•‘ : @ManyToOne, @JoinColumn
*/

~~~
## MemberRepository
~~~java
package jpabook.jpashop;


import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Repository  //ìë™ ì»´í¬ë„ŒíŠ¸ ëŒ€ìƒìœ¼ë¡œ ìë™ ë¹ˆë“±ë¡
public class MemberRepository {

    @PersistenceContext // EntityManagerë¥¼ ë¹ˆìœ¼ë¡œ ì£¼ì…í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜
    private EntityManager em;

    public Long save(Member member) {
        em.persist(member); //ê°ì²´ë¥¼ ì €ì¥í•œ ìƒíƒœ(ì˜ì†)
        return member.getId();
    }

    public Member find(Long id){
        return em.find(Member.class, id);
    }
}

~~~

## MemberRepositoryTest

~~~java

@RunWith(SpringRunner.class) //ìŠ¤í”„ë§ ê´€ë ¨í…ŒìŠ¤íŠ¸ì„ì„ ì•Œë¦¼
@SpringBootTest
public class MemberRepositoryTest {

    @Autowired MemberRepository memberRepository;
    //ì˜ì¡´ì„± ì£¼ì…

    @Test
    //@Transactional 
    @Rollback
    public void testMember(){
        Member member = new Member(); //ê°ì²´ìƒì„±
        member.setUsername("ìŠ¹ë¹ˆ");

        Long saveId = memberRepository.save(member); //ìŠ¹ë¹ˆ ì €ì¥

        Member findMember = memberRepository.find(saveId); //ìŠ¹ë¹ˆ ì°¾ê¸°

        Assertions.assertThat(findMember.getId()).isEqualTo(member.getId());
        Assertions.assertThat(findMember.getUsername()).isEqualTo(member.getUsername());
        Assertions.assertThat(findMember).isEqualTo(member);
    }

}
~~~
## ì—ëŸ¬
org.springframework.dao.InvalidDataAccessApiUsageException: No EntityManager with actual transaction available for current thread - cannot reliably process 'persist' call; nested exception is javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process 'persist' call <br>
-> No EntityManager with actual transaction available for current thread - cannot reliably process 'persist' call<br>
**"ì—”í‹°í‹°ë¥¼ ë³€ê²½í• ë• íŠ¸ëœì­ì…˜ì„ ì´ìš©í•´ì„œ ë³€ê²½í•´ì•¼í•œë‹¤"**
ë”°ë¼ì„œ  í…ŒìŠ¤íŠ¸ì½”ë“œì— ì–´ë…¸í…Œì´ì…˜ @Transactionalì„ ì¶”ê°€í•´ íŠ¸ëœì­ì…˜ì„ ì´ìš©í•´ì„œ ì—”í‹°í‹°ë¥¼ ë³€ê²½í•´ì¤€ë‹¤.

## MemberRepositoryTest

~~~java

@RunWith(SpringRunner.class) //ìŠ¤í”„ë§ ê´€ë ¨í…ŒìŠ¤íŠ¸ì„ì„ ì•Œë¦¼
@SpringBootTest
public class MemberRepositoryTest {

    @Autowired MemberRepository memberRepository;
    //ì˜ì¡´ì„± ì£¼ì…

    @Test
    @Transactional  //íŠ¸ëœì­ì…˜ ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ íŠ¸ëœì­ì…˜ì„ ì´ìš©í•´ì„œ ì—”í‹°í‹°ë¥¼ë³€ê²½í•œë‹¤. 
    @Rollback
    public void testMember(){
        Member member = new Member(); //ê°ì²´ìƒì„±
        member.setUsername("ìŠ¹ë¹ˆ");

        Long saveId = memberRepository.save(member); //ìŠ¹ë¹ˆ ì €ì¥

        Member findMember = memberRepository.find(saveId); //ìŠ¹ë¹ˆ ì°¾ê¸°

        Assertions.assertThat(findMember.getId()).isEqualTo(member.getId());
        Assertions.assertThat(findMember.getUsername()).isEqualTo(member.getUsername());
        Assertions.assertThat(findMember).isEqualTo(member);
    }

}
~~~
## @Rollback
- @Rollbackì´ë¼ëŠ” ê¸°ëŠ¥ì„ ì“°ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ insertí•œ ë°ì´í„°ë“¤ì„ ë‹¤ì‹œ rollback ì‹œì¼œì¤€ë‹¤
- @Rollbackì€ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ insertëœ ë°ì´í„°ë“¤ë§Œ rollbackì‹œì¼œì£¼ì§€,
ëª¨ë“  ë°ì´í„°ë¥¼ rollbackì‹œí‚¨ë‹¤ëŠ” ì˜ë¯¸
- @Rollback(false) ë¡œ í…ŒìŠ¤íŠ¸ì½”ë“œì—ì„œ ì¸ì„¤íŠ¸í•œ ë°ì´í„°ë¥¼ ë¡¤ë°±ì‹œí‚¤ì§€ ì•Šê³  ì ìš©ì‹œí‚¬ ìˆ˜ ë„ìˆë‹¤.

## @SpringBootTest
- ì‹¤ì œ ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ë„ì–´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ìˆê²Œí•´ì£¼ì–´ì„œ @Autowiredìœ¼ë¡œ ë¹ˆì„ ì£¼ì…ë°›ì„ ìˆ˜ ìˆë‹¤.
## @RunWith(SpringRunner.class)
- junit4 ì™€ junit5ì˜ì°¨ì´ì˜¤ junit5ëŠ” ìƒëµ ê°€ëŠ¥
<br>
<br>
<br>
<br>

## REF
ì¸í”„ëŸ° ê¹€ì˜í•œë‹˜ _
ì‹¤ì „! ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ JPA í™œìš©1 - ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ