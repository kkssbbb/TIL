# ëª©ì°¨
- ğŸ“ŒíšŒì› ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
- ğŸ“ŒíšŒì› ì„œë¹„ìŠ¤ ê°œë°œ
- ğŸ“ŒíšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
<br>
<br>

## êµ¬í˜„ ê¸°ëŠ¥
- íšŒì› ë“±ë¡
- íšŒì› ëª©ë¡ ì¡°íšŒ
<br>
<br>

## ìˆœì„œ
- íšŒì› ì—”í‹°í‹° ì½”ë“œ ë‹¤ì‹œë³´ê¸°
- íšŒì› ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
- íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ
- íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

<br>
<br>
<br>
<br>

# ğŸ“ŒíšŒì› ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
## íšŒì› ë¦¬íŒŒì§€í† ë¦¬
~~~java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.Member;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import java.util.List;

@Repository // ë¹ˆ ìë™ ë“±ë¡
@RequiredArgsConstructor
public class MemberRepository {

    //@PersistenceContext //ìŠ¤í”„ë§ ì—”í‹°í‹°ë©”ë‹ˆì € ìƒì„±í›„ ì—¬ê¸°ë¡œ ì¸ì ì…˜
    private  final EntityManager em;

    public void save(Member member){  //íšŒì› ì €ì¥
        em.persist(member);
    }

    public Member findOne(Long id){  //í•œëª… ì¡°íšŒ
        return em.find(Member.class,id);
    }

    public List<Member> findAll(){  //ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
        return em.createQuery("select m from Member m" , Member.class) //JSQL,í´ë˜ìŠ¤ íƒ€ì…
                .getResultList();

    }
    public List<Member> findByName(String name){ //íŠ¹ì •íšŒì› ì´ë¦„ ì¡°íšŒ
        return em.createQuery("select m from Member m where m.name = :name", Member.class)
                .setParameter("name", name)
                .getResultList();
    }
}

~~~

## ì–´ë…¸í…Œì´ì…˜ ê¸°ìˆ  ì„¤ëª…
### @Repository
- ìŠ¤í”„ë§ ë¹ˆ ìë™ ë“±ë¡, JPAì˜ˆì™¸ë¥¼ ìŠ¤í”„ë§ ê¸°ë°˜ ì˜ˆì™¸ë¡œ ì˜ˆì™¸ ë³€í™˜
### @PersistenceContext
- ì—”í‹°í‹° ë§¤ë‹ˆì ¸(EntutyManager) ì£¼ì…
### @PersistenceUnit
- ì—”í‹°í‹° ë©”ë‹ˆí„° íŒ©í† ë¦¬ (EntituManagerFactory) ì£¼ì…
<br>
<br>

## ë©”ì„œë“œ ê¸°ëŠ¥ ì„¤ëª…
save()  <br>
findOne() <br>
findeAll() <br>
findByName() <br>

<br>
<br>
<br>
<br>

# ğŸ“ŒíšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

## íšŒì› ì„œë¹„ìŠ¤
~~~java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.Member;
import jpabook.jpashop.repository.MemberRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;


import java.util.List;

@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class MemberService {

    private final MemberRepository memberRepository;

  /*
  @RequiredArgsConstructor ê°€ ë°‘ ìƒì„±ì ìë™ ìƒì„±(ë¡¬ë¶ê¸°ëŠ¥)
  @Autowired
    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }*/

    //íšŒì›ê°€ì…
    @Transactional
    public Long join(Member member){

        validateDuplicateMember(member); //ì¤‘ë³µ íšŒì› ì¡°íšŒ
        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member){
        List<Member> findMembers = memberRepository.findByName(member.getName());
        if(!findMembers.isEmpty()){
            throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        }
    }

    //íšŒì› ì „ì²´ ì¡°íšŒ
    public List<Member> findMember(){
        return memberRepository.findAll();
    }

    public Member findOne(Long memberId){
        return memberRepository.findOne(memberId);
    }

}

~~~
## ì–´ë…¸í…Œì´ì…˜ ê¸°ìˆ  ì„¤ëª…
### @Service
### @Transactional
- íŠ¸ëœì­ì…˜, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸
    - readOnly=true : ë°ì´í„°ì˜ ë³€ê²½ì´ ì—†ëŠ” ì½ê¸°ì „ìš©ë©”ì„œë“œ, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œ í•˜ì§€ ì•Šì•„ ì•½ê°„ì˜ ì„±ëŠ¥ì´ í–¥ìƒ ëœë‹¤.
    - ë°ì´í„°ë² ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ ì§€ì›í™”ë©´ DBì—ì„œ ì„±ëŠ¥ í–¥ìƒ
### @Autowired
- ìƒì„±ì ì¸ì ì…˜ ë§ì´ ì‚¬ìš©, ìƒì„±ìê°€ í•˜ë‚˜ë©´ ìƒëµê°€ëŠ¥
<br>
<br>

## ë©”ì„œë“œ ê¸°ëŠ¥ ì„¤ëª…
join()  <br>
findMembers() <br>
findOne() <br>


## ìŠ¤í”„ë§ í•„ë“œì£¼ì… ëŒ€ì‹  ìƒì„±ìì£¼ì… ì‚¬ìš© ê¶Œì¥
### í•„ë“œì£¼ì…
~~~java
public class MemberService {
 @Autowired
 MemberRepository memberRepository;
 ...
}
~~~

### ìƒì„±ì ì£¼ì…
~~~java
public class MemberService {
 private final MemberRepository memberRepository;
 public MemberService(MemberRepository memberRepository) {
 this.memberRepository = memberRepository;
 }
 ...
}
~~~

- ìƒì„±ì ì£¼ì… ë°©ì‹ ê¶Œì¥
- ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ì•ˆì „í•œ ê°ì²´ ìƒì„± ê°€ëŠ¥
- finalí‚¤ì›Œë“œ ì¶”ê°€ì‹œ ì»´íŒŒì¼ ì‹œì ì— memberRepositoryë¥¼ ì„¤ì •í•˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ë¥¼ ì²´í¬í•  ìˆ˜ ìˆë‹¤.

<br>
<br>
<br>
<br>

# ğŸ“ŒíšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
## í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­
- íšŒì›ê°€ì… ì„±ê³µ
- íšŒì›ê°€ì…ì‹œ ì¤‘ë³µì´ë¦„ ìˆì„ì‹œ ì˜ˆì™¸ë°œìƒ

~~~java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.Member;
import jpabook.jpashop.repository.MemberRepository;
import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.Rollback;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;


@RunWith(SpringRunner.class)
@SpringBootTest
@Transactional
public class MemberServiceTest{
    @Autowired MemberRepository memberRepository;
    @Autowired MemberService memberService;


    @Test
    public void íšŒì›ê°€ì…í…ŒìŠ¤íŠ¸() throws Exception{
        //g
        Member m = new Member();
        m.setName("ìŠ¹ë¹ˆ");
        //w
        Long mId = memberService.join(m);

        //t
        Assert.assertEquals(m,memberRepository.findOne(mId));
    }

    @Test(expected = IllegalStateException.class)
    public void íšŒì›ì¤‘ë³µí…ŒìŠ¤íŠ¸(){
        //g
        Member m = new Member();
        m.setName("í™ê¸¸ë™");
        Member m1 = new Member();
        m1.setName("í™ê¸¸ë™");
        //v
        Long member_ID = memberService.join(m);
        Long member1_ID = memberService.join(m1);

        //t
        Assert.fail("ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.");

    }


}
~~~

<br>
<br>
<br>
<br>

# ğŸ“Œì–´ë…¸í…Œì´ì…˜ ì •ë¦¬
@RunWith(SpringRunner.class)
- ì‹¤í–‰ ë°©ë²™ì„ í™•ì¥í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜
- JUnit4.x í”„ë ˆì„ì›Œí¬ê°€ ë‚´ì¥ëœ Runnerë¥¼ ì‹¤í–‰í•  ë•Œ SpringRunner.classë¼ëŠ” í™•ì¥ëœ í´ë˜ìŠ¤ë¥¼ ì‹¤í–‰í•œë‹¤.
- ë”°ë¼ì„œ í…ŒìŠ¤íŠ¸ì‹œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í™œìš©í•  ìˆ˜ ìˆê²Œëœë‹¤.
- SpringBoot2.1 ë²„ì „ë¶€í„° JUnit5.xë¡œ ë³€ê²½ë˜ê³  @SpringBootTestì–´ë…¸í…Œì´ì…˜ì— í¬í•¨ë˜ë„ë¡ ë³€ê²½ë˜ì–´ ë³„ë„ë¡œ ì •ì˜í•  í•„ìš”ëŠ” ì—†ì–´ ì¡Œë‹¤.

@SpringBootTest
- í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ìŠ¤í”„ë§ë¶€íŠ¸ì˜ ê¸°ë³¸ì ì¸ ì–´ë…¸í…Œì´ì…˜ì´ë‹¤.
- ì—¬ëŸ¬ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë‚˜ì˜ í†µí•©ëœ í…ŒìŠ¤íŠ¸ë¡œ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- JUnit4.x ëŠ” @RunWith ì–´ë…¸í…Œì´ì…˜ì„ ê°™ì´ ì‚¬ìš©í•´ì•¼ ì •ìƒ ì‘ë™í•œë‹¤.(JUnitì˜ SpringJUnit4ClassRunner í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì•„ ì‚¬ìš© í•´ì•¼í•œë‹¤.)


@Transactional


### REF
- https://cheese10yun.github.io/spring-boot-test/
- https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1/lecture/24291?tab=note&volume=1.00&speed=1.5&quality=1080