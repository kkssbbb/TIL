# ëª©ì°¨
- ğŸ“Œì£¼ë¬¸, ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ
- ğŸ“Œì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
- ğŸ“Œì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ
- ğŸ“Œì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- ğŸ“Œì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ

<br>
<br>
<br>
<br>


# ğŸ“Œì£¼ë¬¸, ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ
## ì£¼ë¬¸ ì—”í‹°í‹° ì½”ë“œ
~~~java
package jpabook.jpashop.domain;


import lombok.Getter;
import lombok.Setter;


import javax.persistence.Column;
import javax.persistence.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "orders")
@Getter @Setter
public class Order {

    @Id
    @GeneratedValue
    @Column(name = "order_id")
    private Long id;

    @ManyToOne
    @JoinColumn(name = "member_id") //í¬ë§í‚¤ ì´ë¦„
    private Member member;

    @OneToMany(mappedBy = "order", cascade = CascadeType.ALL)
    //cascade = CascadeType.ALL = orderë¥¼ persist í• ë•Œ ìë™ìœ¼ë¡œ orderItemsë„ ì €ì¥í•œë‹¤.
    private List<OrderItem> orderItems = new ArrayList<>();

    @OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)
    @JoinColumn(name = "delivety_id")
    private Delivery delivery;

    private LocalDateTime orderData; //ì£¼ë¬¸ì‹œê°„

    @Enumerated(EnumType.STRING)
    private OrderStatus status; //ì£¼ë¬¸ìƒíƒœ [ORDER, CANCEL]

    // ì—°ê´€ê´€ê³„ ë©”ì„œë“œ // ì–‘ë°©í–¥ì¼ë•Œ ì“°ë©´ ì¢‹ë‹¤
    public void setMember(Member member) {
        this.member = member;
        member.getOrders().add(this);
    }

    public void addOrderItem(OrderItem orderItem) {
        orderItems.add(orderItem);
        orderItem.setOrder(this);
    }

    public void setDelivery(Delivery delivery) {
        this.delivery = delivery;
        delivery.setOrder(this);
    }


    //ìƒì„± ë©”ì„œë“œ//
    public static Order createOrder(Member member, Delivery delivery, OrderItem... orderItems) {
        Order order = new Order();
        order.setMember(member);
        order.setDelivery(delivery);
        for (OrderItem orderItem : orderItems) {
            order.addOrderItem(orderItem);
        }
        order.setStatus(OrderStatus.ORDER);
        order.setOrderData(LocalDateTime.now());
    return  order;
    }

    //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    /*ì£¼ë¬¸ì·¨ì†Œ*/
    public void cancel(){
        if(delivery.getStatus() == DeliveryStatus.COMP){
            throw new IllegalStateException("ì´ë¯¸ ë°°ì†¡ì™„ë£Œëœ ìƒí’ˆì€ ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥ í•©ë‹ˆë‹¤.");
        }

        this.setStatus(OrderStatus.CANCEL);
        for(OrderItem orderItem : orderItems){
            orderItem.cancel();
        }
    }

    //ì¡°íšŒ ë¡œì§
    /*ì „ì²´ ì£¼ë¬¸ ê°€ê²© ì¡°íšŒ*/
    public int getTotalPrice(){
        int totalPrice = 0;
        for (OrderItem orderItem : orderItems){
            totalPrice += orderItem.getOrderPrice();
        }
        return totalPrice;
    }
}
~~~
ê¸°ëŠ¥(ë©”ì„œë“œ)ì„¤ëª…
- **createOrder()** : ìƒì„±ë©”ì„œë“œ , ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•  ë•Œ  ì‚¬ìš©í•œë‹¤. ì£¼ë¬¸ íšŒì›,ë°°ì†¡ì •ë³´, ì£¼ë¬¸ìƒí’ˆì˜ ì •ë³´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì‹¤ì œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤.
- **cancel()** : ì£¼ë¬¸ì·¨ì†Œë©”ì„œë“œ, ì£¼ë¬¸ ì·¨ì†Œì‹œ ì‚¬ìš©í•œë‹¤. 
- **getTotalPrice()** : ì „ì²´ ì£¼ë¬¸ ê°€ê²© ì¡°íšŒ, ì£¼ë¬¸ ì‹œ ì‚¬ìš©í•œ ì „ì²´ ì£¼ë¬¸ ê°€ê²©ì„ ì¡°íšŒí•œë‹¤. ì „ì²´ ì£¼ë¬¸ ê°€ê²©ì„ ì•Œë ¤ë©´ ê°ê°ì˜ ì£¼ë¬¸ìƒí’ˆ ê°€ê²©ì„ ì•Œì•„ì•¼í•˜ê¸°ë–„ë¬¸ì— ë¡œì§ì€ orderItemsë¥¼ í¬ë¬¸ìœ¼ë¡œ í•˜ë‚˜ì”© orderItemì— ë°›ì•„ì„œ  í•˜ë‚˜ì”© ë”í•œ ê°’ì„ ë°˜í™˜í•œë‹¤ (ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ì£¼ë¬¸ì— ì „ì²´ ì£¼ë¬¸ ê°€ê²© í•„ë“œë¥¼ ë‘ê³  ì—­ì •ê·œí™” í•œë‹¤.)

<br>
<br>
<br>

## ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ì½”ë“œ
~~~java
package jpabook.jpashop.domain;

import jpabook.jpashop.domain.item.Item;
import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;

@Entity
@Getter
@Setter
public class OrderItem {

    @Id @GeneratedValue
    @Column(name = "order_item_id")
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "item_id")
    private Item item;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "order_id") //ì™¸ë˜í‚¤ ë§µí•‘
    private Order order;

    private int orderPrice; // ì£¼ë¬¸ê°€ê²©

    private int count;

    //ìƒì„± ë©”ì„œë“œ
    public static OrderItem createOrderItem(Item item, int orderPrice, int count){
        OrderItem orderItem = new OrderItem();
        orderItem.setItem(item);
        orderItem.setOrderPrice(orderPrice);
        orderItem.setCount(count);

        item.removeStock(count);
        return orderItem;
    }

    //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    public void cancel(){
        getItem().addStock(count);
    }
    //ì¡°íšŒë¡œì§
    public int getTotalPrice(){
        return  getOrderPrice() * getCount();
    }


}

~~~
ê¸°ëŠ¥(ë©”ì„œë“œ)ì„¤ëª…
- **createOrderItem()** : ìƒì„±ë©”ì„œë“œ, ì£¼ë¬¸ìƒí’ˆ,ê°€ê²©,ìˆ˜ëŸ‰ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤.
ê·¸ë¦¬ê³  item.removeStock(count)ë¥¼ í˜¸ì¶œí•´ì„œ ì£¼ë¬¸í•œ ìˆ˜ëŸ‰ë§Œí¼ ìƒí’ˆì˜ ì¬ê³ ë¥¼ ì¤„ì¸ë‹¤.
- **cancel()** : ì£¼ë¬¸ì·¨ì†Œ,ì·¨ì†Œí•œ ì£¼ë¬¸ ìˆ˜ëŸ‰ ë§Œí¼ ìƒí’ˆì˜ ì¬ê³ ë¥¼ ëŠ˜ë¦°ë‹¤.
- **getTotalPrice()** : ì£¼ë¬¸ ê°€ê²© ì¡°íšŒ,ì£¼ë¬¸ê°€ê²©ê³¼ ìƒí’ˆìˆ˜ë¥¼ ê³±í•´ì„œ ë°˜í™˜í•œë‹¤. 
<br>
<br>
<br>
<br>

# ğŸ“Œì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

<br>
<br>
<br>
<br>

# ğŸ“Œì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ

<br>
<br>
<br>
<br>

# ğŸ“Œì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸


<br>
<br>
<br>
<br>

# ğŸ“Œì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ

## REF
- https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-1/dashboard