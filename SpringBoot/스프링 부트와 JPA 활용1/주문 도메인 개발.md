# ëª©ì°¨
- ğŸ“Œì£¼ë¬¸, ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ
- ğŸ“Œì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
- ğŸ“Œì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ
- ğŸ“Œì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- ğŸ“Œì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ

<br>
<br>
<br>
<br>


# ğŸ“Œì£¼ë¬¸, ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ
## ì£¼ë¬¸ ì—”í‹°í‹° ì½”ë“œ
~~~java
package jpabook.jpashop.domain;


import lombok.Getter;
import lombok.Setter;


import javax.persistence.Column;
import javax.persistence.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "orders")
@Getter @Setter
public class Order {

    @Id
    @GeneratedValue
    @Column(name = "order_id")
    private Long id;

    @ManyToOne
    @JoinColumn(name = "member_id") //í¬ë§í‚¤ ì´ë¦„
    private Member member;

    @OneToMany(mappedBy = "order", cascade = CascadeType.ALL)
    //cascade = CascadeType.ALL = orderë¥¼ persist í• ë•Œ ìë™ìœ¼ë¡œ orderItemsë„ ì €ì¥í•œë‹¤.
    private List<OrderItem> orderItems = new ArrayList<>();

    @OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)
    @JoinColumn(name = "delivety_id")
    private Delivery delivery;

    private LocalDateTime orderData; //ì£¼ë¬¸ì‹œê°„

    @Enumerated(EnumType.STRING)
    private OrderStatus status; //ì£¼ë¬¸ìƒíƒœ [ORDER, CANCEL]

    // ì—°ê´€ê´€ê³„ ë©”ì„œë“œ // ì–‘ë°©í–¥ì¼ë•Œ ì“°ë©´ ì¢‹ë‹¤
    public void setMember(Member member) {
        this.member = member;
        member.getOrders().add(this);
    }

    public void addOrderItem(OrderItem orderItem) {
        orderItems.add(orderItem);
        orderItem.setOrder(this);
    }

    public void setDelivery(Delivery delivery) {
        this.delivery = delivery;
        delivery.setOrder(this);
    }


    //ìƒì„± ë©”ì„œë“œ//
    public static Order createOrder(Member member, Delivery delivery, OrderItem... orderItems) {
        Order order = new Order();
        order.setMember(member);
        order.setDelivery(delivery);
        for (OrderItem orderItem : orderItems) {
            order.addOrderItem(orderItem);
        }
        order.setStatus(OrderStatus.ORDER);
        order.setOrderData(LocalDateTime.now());
    return  order;
    }

    //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    /*ì£¼ë¬¸ì·¨ì†Œ*/
    public void cancel(){
        if(delivery.getStatus() == DeliveryStatus.COMP){
            throw new IllegalStateException("ì´ë¯¸ ë°°ì†¡ì™„ë£Œëœ ìƒí’ˆì€ ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥ í•©ë‹ˆë‹¤.");
        }

        this.setStatus(OrderStatus.CANCEL);
        for(OrderItem orderItem : orderItems){
            orderItem.cancel();
        }
    }

    //ì¡°íšŒ ë¡œì§
    /*ì „ì²´ ì£¼ë¬¸ ê°€ê²© ì¡°íšŒ*/
    public int getTotalPrice(){
        int totalPrice = 0;
        for (OrderItem orderItem : orderItems){
            totalPrice += orderItem.getOrderPrice();
        }
        return totalPrice;
    }
}
~~~
ê¸°ëŠ¥(ë©”ì„œë“œ)ì„¤ëª…
- **createOrder()** : ìƒì„±ë©”ì„œë“œ , ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•  ë•Œ  ì‚¬ìš©í•œë‹¤. ì£¼ë¬¸ íšŒì›,ë°°ì†¡ì •ë³´, ì£¼ë¬¸ìƒí’ˆì˜ ì •ë³´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì‹¤ì œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤.
- **cancel()** : ì£¼ë¬¸ì·¨ì†Œë©”ì„œë“œ, ì£¼ë¬¸ ì·¨ì†Œì‹œ ì‚¬ìš©í•œë‹¤. 
- **getTotalPrice()** : ì „ì²´ ì£¼ë¬¸ ê°€ê²© ì¡°íšŒ, ì£¼ë¬¸ ì‹œ ì‚¬ìš©í•œ ì „ì²´ ì£¼ë¬¸ ê°€ê²©ì„ ì¡°íšŒí•œë‹¤. ì „ì²´ ì£¼ë¬¸ ê°€ê²©ì„ ì•Œë ¤ë©´ ê°ê°ì˜ ì£¼ë¬¸ìƒí’ˆ ê°€ê²©ì„ ì•Œì•„ì•¼í•˜ê¸°ë–„ë¬¸ì— ë¡œì§ì€ orderItemsë¥¼ í¬ë¬¸ìœ¼ë¡œ í•˜ë‚˜ì”© orderItemì— ë°›ì•„ì„œ  í•˜ë‚˜ì”© ë”í•œ ê°’ì„ ë°˜í™˜í•œë‹¤ (ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ì£¼ë¬¸ì— ì „ì²´ ì£¼ë¬¸ ê°€ê²© í•„ë“œë¥¼ ë‘ê³  ì—­ì •ê·œí™” í•œë‹¤.)

<br>
<br>
<br>

## ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ì½”ë“œ
~~~java
package jpabook.jpashop.domain;

import jpabook.jpashop.domain.item.Item;
import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;

@Entity
@Getter
@Setter
public class OrderItem {

    @Id @GeneratedValue
    @Column(name = "order_item_id")
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "item_id")
    private Item item;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "order_id") //ì™¸ë˜í‚¤ ë§µí•‘
    private Order order;

    private int orderPrice; // ì£¼ë¬¸ê°€ê²©

    private int count;

    //ìƒì„± ë©”ì„œë“œ
    public static OrderItem createOrderItem(Item item, int orderPrice, int count){
        OrderItem orderItem = new OrderItem();
        orderItem.setItem(item);
        orderItem.setOrderPrice(orderPrice);
        orderItem.setCount(count);

        item.removeStock(count);
        return orderItem;
    }

    //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    public void cancel(){
        getItem().addStock(count);
    }
    //ì¡°íšŒë¡œì§
    public int getTotalPrice(){
        return  getOrderPrice() * getCount();
    }


}

~~~
ê¸°ëŠ¥(ë©”ì„œë“œ)ì„¤ëª…
- **createOrderItem()** : ìƒì„±ë©”ì„œë“œ, ì£¼ë¬¸ìƒí’ˆ,ê°€ê²©,ìˆ˜ëŸ‰ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤.
ê·¸ë¦¬ê³  item.removeStock(count)ë¥¼ í˜¸ì¶œí•´ì„œ ì£¼ë¬¸í•œ ìˆ˜ëŸ‰ë§Œí¼ ìƒí’ˆì˜ ì¬ê³ ë¥¼ ì¤„ì¸ë‹¤.
- **cancel()** : ì£¼ë¬¸ì·¨ì†Œ,ì·¨ì†Œí•œ ì£¼ë¬¸ ìˆ˜ëŸ‰ ë§Œí¼ ìƒí’ˆì˜ ì¬ê³ ë¥¼ ëŠ˜ë¦°ë‹¤.
- **getTotalPrice()** : ì£¼ë¬¸ ê°€ê²© ì¡°íšŒ,ì£¼ë¬¸ê°€ê²©ê³¼ ìƒí’ˆìˆ˜ë¥¼ ê³±í•´ì„œ ë°˜í™˜í•œë‹¤. 
<br>
<br>
<br>
<br>

# ğŸ“Œì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
~~~java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.Order;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;

@Repository
@RequiredArgsConstructor
public class OrderRepository {

    private final EntityManager em;

    public void save(Order order) {
        em.persist(order);
    }

    public Order findOne(Long id) {
        return em.find(Order.class, id);
    }

    // public List<order> findAll(OrderSearch orderSearch){}
}

~~~
- ì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ì—ëŠ” ì£¼ë¬¸ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ê³  ë‹¨ê±´ê²€ìƒ‰ê¸°ëŠ¥ì´ ìˆë‹¤.
- findAll(OrderSearch orderSearch) ë©”ì„œë“œëŠ” ë‚˜ì¤‘ì— ì¶”ê°€í•˜ë„ë¡ í•œë‹¤.

<br>
<br>
<br>
<br>

# ğŸ“Œì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ
## ì£¼ë¬¸ ì„œë¹„ìŠ¤ ì½”ë“œ
~~~java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.Delivery;
import jpabook.jpashop.domain.Member;
import jpabook.jpashop.domain.Order;
import jpabook.jpashop.domain.OrderItem;
import jpabook.jpashop.domain.item.Item;
import jpabook.jpashop.repository.ItemRepository;
import jpabook.jpashop.repository.MemberRepository;
import jpabook.jpashop.repository.OrderRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class OrderService {

        private  final OrderRepository orderRepository;
        private  final MemberRepository memberRepository;
        private final ItemRepository itemRepository;
    //ì£¼ë¬¸
    @Transactional
    public Long order(Long memberId, Long itemId, int count) {

        //ì—”í‹°í‹° ì¡°íšŒ
        Member member = memberRepository.findOne(memberId);
        Item item = itemRepository.findOne(itemId);

        //ë°°ì†¡ì •ë³´ ìƒì„±
        Delivery delivery = new Delivery();
        delivery.setAddress(member.getAddress());

        //ì£¼ë¬¸ìƒí’ˆ ìƒì„±
        OrderItem orderItem = OrderItem.createOrderItem(item, item.getPrice(), count);

        //ì£¼ë¬¸ ìƒì„±
        Order order = Order.createOrder(member, delivery, orderItem);

        //ì£¼ë¬¸ ì €ì¥
        orderRepository.save(order);

        return order.getId();
    }


    //ì£¼ë¬¸ì·¨ì†Œ
    @Transactional
    public void cancelOrder(Long orderId) {
        //ì£¼ë¬¸ ì—”í‹°í‹° ì¡°íšŒ
        Order order = orderRepository.findOne(orderId);
        //ì£¼ë¬¸ ì·¨ì†Œ
        order.cancel();
    }

    //ê²€ìƒ‰
    /*public List<Order> findOrders(OrderSearch orderSearch){
        return orderRepository.findAll(orderSearch);
    */
}



~~~
## ì£¼ë¬¸ ì„œë¹„ìŠ¤ ê¸°ëŠ¥
- ì£¼ë¬¸, ì£¼ë¬¸ì·¨ì†Œ,ì£¼ë¬¸ë‚´ì—­ ê²€ìƒ‰
>ì˜ˆì œì˜ ë‹¨í›„í™”ë¥¼ ìœ„í•´ì„œ í•œ ë²ˆì— í•˜ë‚˜ì˜ ìƒí’ˆë§Œ ì£¼ë¬¸í•  ìˆ˜ ìˆë‹¤.
- order() : ì£¼ë¬¸, ì£¼ë¬¸í•˜ëŠ” íšŒì›ì˜ Id, ìƒí’ˆId ,ì£¼ë¬¸ ìˆ˜ëŸ‰ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì‹¤ì œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œ í›„ ì €ì¥í•œë‹¤.
- cancelOrder() : ì£¼ë¬¸Idë¥¼ ë°›ì•„ì„œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒ í›„ ì£¼ë¬¸ ì—”í‹°í‹°ì— ì£¼ë¬¸ì·¨ì†Œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
- findOrders() : ì£¼ë¬¸ê²€ìƒ‰, OrderSearch ë¼ëŠ” ê²€ìƒ‰ ì¡°ê±´ì„ ê°€ì§„ ê°ì²´ë¡œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ê²€ìƒ‰í•œë‹¤. êµ¬í˜„ì€ ì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ íŒŒíŠ¸ì—ì„œ ì¶”ê°€í•œë‹¤.
<br>
<br>
<br>
<br>

## ë„ë©”ì¸ ëª¨ë¸ íŒ¨í„´, íŠ¸ëœì­ì…˜ ìŠ¤í¬ë¦½íŠ¸ íŒ¨í„´ì´ë€?
- ë„ë©”ì¸ ëª¨ë¸ íŒ¨í„´
    - ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ ëŒ€ë¶€ë¶„ ì—”í‹°í‹°ì—ìˆë‹¤. ì„œë¹„ìŠ¤ ê³„ì¸µì€ ë‹¨ìˆœíˆ ì—”í‹°í‹°ì— í•„ìš”í•œ ìš”ì²­ì„ ìœ„ì„í•˜ëŠ” ì—­í• ì„í•œë‹¤. ì´ ì²˜ëŸ¼ ì—”í‹°í‹°ê°€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ê°€ì§€ê³  ê°ì²´ì§€í–¥ì˜ íŠ¹ì„±ì„ ì ê·¹ í™œìš©í•˜ëŠ” ê²ƒì„ ë„ë©”ì¸ ëª¨ë¸íŒ¨í„´ì´ë¼ê³ í•œë‹¤.
- íŠ¸ëœì­ì…˜ ìŠ¤í¬ë¦½íŠ¸ íŒ¨í„´
    - ë°˜ëŒ€ë¡œ íŠ¸ëœì­ì…˜ ìŠ¤í¬ë¦½íŠ¸ íŒ¨í„´ì€ ì„œë¹„ìŠ¤ê³„ì¸µì—ì„œ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ìŠ¤íƒ€ì¼ì„ ìŠ¤í¬ë¦½íŠ¸ íŒ¨í„´ì´ë¼ê³  í•œë‹¤.
<br>
<br>
<br>
<br>

# ğŸ“Œì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
### í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­
- ìƒí’ˆ ì£¼ë¬¸ì„ ì„±ê³µí•´ì•¼ í•œë‹¤.
- ìƒí’ˆì„ ì£¼ë¬¸í•  ë•Œ ì¬ê³  ìˆ˜ëŸ‰ì„ ì´ˆê³¼í•˜ë©´ ì•ˆ ëœë‹¤.
- ì£¼ë¬¸ ì·¨ì†Œë¥¼ ì„±ê³µí•´ì•¼ í•œë‹¤.

~~~java
package jpabook.jpashop.service;
import jpabook.jpashop.domain.*;
import jpabook.jpashop.domain.item.Book;
import jpabook.jpashop.exception.NotEnoughStockException;
import jpabook.jpashop.repository.OrderRepository;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import static org.junit.Assert.*;

@SpringBootTest
@RunWith(SpringRunner.class)
@Transactional
public class OrderServiceTest {

    @PersistenceContext
    EntityManager em;
    @Autowired OrderService orderService;
    @Autowired
    OrderRepository orderRepository;
    @Test
    public void ìƒí’ˆì£¼ë¬¸() throws Exception {
        Member member = createMember();

        Book book = createBook("ì‚¼êµ­ì§€", 10000, 100);

        int orderCount = 2;

        //w
       Long orderId = orderService.order(member.getId(), book.getId(), orderCount);
        System.out.println("orderId = " + orderId);
       //t
        Order getOrder = orderRepository.findOne(orderId);
        assertEquals("ìƒí’ˆ ì£¼ë¬¸ì‹œ ìƒíƒœëŠ” ORDER",OrderStatus.ORDER,getOrder.getStatus());
        assertEquals("ì£¼ë¬¸í•œ ìƒí’ˆ ì¢…ë¥˜ ìˆ˜ê°€ ì •í™•í•´ì•¼ í•œë‹¤.",1, getOrder.getOrderItems().size());
        assertEquals("ì£¼ë¬¸ê°€ê²©ì€ ê°€ê²© * ìˆ˜ëŸ‰",10000,getOrder.getTotalPrice());
        assertEquals("ì£¼ë¬¸ ìˆ˜ëŸ‰ë§Œí¼ ì¬ê³ ê°€ ì¤„ì–´ì•¼í•œë‹¤.",98,book.getStockQuantity());
    }



    @Test(expected = NotEnoughStockException.class)
    public void ìƒí’ˆì£¼ë¬¸_ì¬ê³ ìˆ˜ëŸ‰ì´ˆê³¼() throws Exception{
        //g
        Member member = createMember();
        Book book = createBook("ì‚¼êµ­ì§€", 10000, 100);

        int orderCount = 111;
        //w
        orderService.order(member.getId(), book.getId() ,orderCount);
        //t
        fail("ì¬ê³  ìˆ˜ëŸ‰ ë¶€ì¡± ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼í•œë‹¤.");
    }

    @Test
    public void ì£¼ë¬¸ì·¨ì†Œ() throws Exception{
        //g
        Member member = createMember();
        Book book = createBook("ì‚¼êµ­ì§€", 10000, 100);
        int count = 10;

        Long order = orderService.order(member.getId(), book.getId(), count);
        //w
        orderService.cancelOrder(order);

        //t
        Order getOrder = orderRepository.findOne(order);
        assertEquals("ì£¼ë¬¸ ì·¨ì†Œì‹œ ìƒíƒœëŠ” ìº”ìŠ¬ì´ë‹¤.",OrderStatus.CANCEL, getOrder.getStatus());
        assertEquals("ì£¼ë¬¸ ì·¨ì†Œëœ ìƒí’ˆì€ ê·¸ë§Œí¼ ì¬ê³ ê°€ ì¦ê°€í•´ì•¼í•œë‹¤.", 100,book.getStockQuantity());
    }


    private Book createBook(String name, int price, int stockQuantity) {
        Book book = new Book();
        book.setName(name);
        book.setPrice(price);
        book.setStockQuantity(stockQuantity);
        em.persist(book);
        return book;
    }

    private Member createMember() {
        Member member = new Member();
        member.setName("ìŠ¹ë¹ˆ");
        member.setAddress(new Address("ì„œìš¸", "ì—­ì‚¼ë™", "13245"));
        em.persist(member);
        return member;
    }

}
~~~

### public void ìƒí’ˆì£¼ë¬¸()
- Member createMember() ì™€
Book createBook(String name, int price, int stockQuantity)ìƒì„± ë©”ì„œë“œë¥¼ ë§Œë“¤  ìƒí’ˆì£¼ë¬¸ í…ŒìŠ¤íŠ¸ì— íšŒì›ê³¼ ìƒí’ˆì„ ë§Œë“¤ê³  ìƒí’ˆì„ ì£¼ë¬¸í•´ ë³´ì•„ì„œ ì¬ê³ ìˆ˜ëŸ‰ì´ ì£¼ë¬¸ìˆ˜ëŸ‰ë§Œí´ ì¤„ì—ˆëŠ”ì§€ ê²€ì¦í•œë‹¤.
### public void ìƒí’ˆì£¼ë¬¸_ì¬ê³ ìˆ˜ëŸ‰ì´ˆê³¼()
- @Test(expected = NotEnoughStockException.class)ë¥¼ ì†ì„±ìœ¼ë¡œ ì¶”ê°€í•´ ì¬ê³ ê°€ ë¶€ì¡±í• ì‹œ ê¸°ëŒ€í•˜ëŠ” ì˜ˆì™¸ê°€ ë°œìƒí•œëŠ”ì§€ í…ŒìŠ¤íŠ¸í•œë‹¤.
### public void ì£¼ë¬¸ì·¨ì†Œ()
- ì£¼ë¬¸ì·¨ì†Œì‹œ ì£¼ë¬¸ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì·¨ì†ŒëŒ„ ìƒí’ˆì´ ì¬ê³ ê°€ ë‹¤ì‹œ ì¦ê°€í–ˆëŠ”ì§€ í™•ì¸í•œë‹¤.

<br>
<br>
<br>
<br>

# ğŸ“Œì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ
## JPAì—ì„œ ë™ì  ì¿¼ë¦¬ë¥¼ í•´ê²°í•˜ëŠ” ë°©ì•ˆ
### ğŸ‘€ JPQL
- ì¿¼ë¦¬ë¥¼ ë¬¸ìë¡œ ìƒì„±í•˜ê¸° ë²ˆê±°ë¡­ê³ , ì‹¤ìˆ˜ë¡œ ì¸í•œ ë²„ê·¸ê°€ ìƒê¸¸ ê°€ëŠ¥ì„±ì´ ë§ë‹¤.
### ğŸ‘€ JPA Criteria
- JPA í‘œì¤€ ìŠ¤í™ì´ì§€ë§Œ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•˜ê¸°ì— ìœ ì§€ë³´ìˆ˜ì„±ì´ ë–¨ì–´ì§€ê³  ë„ˆë¬´ ë³µì¡í•˜ë‹¤. 
### ğŸ‘€ Querydsl ë¼ì´ë¸ŒëŸ¬ë¦¬
- ìœ„ ë‘ê°€ì§€ ë°©ì•ˆì˜ í•´ê²°ì±…ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.

## ê²€ìƒ‰ ì¡°ê±´ íŒŒë¼ë¯¸í„° OrderSearch
~~~java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.OrderStatus;
import lombok.Getter;
import lombok.Setter;

@Getter @Setter
public class OrderSearch {

        private String memberName; //íšŒì›ì´ë¦„
        private OrderStatus orderStatus; // ì£¼ë¬¸ìƒíƒœ [ORDER, CANCEL]
}

~~~
<br>
<br>

## ê²€ìƒ‰ ì¶”ê°€ ì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬
~~~java
package jpabook.jpashop.repository;
@Repository
public class OrderRepository {
 @PersistenceContext
 EntityManager em;
 public void save(Order order) {
 em.persist(order);
 }
 public Order findOne(Long id) {
 return em.find(Order.class, id);
 }
 public List<Order> findAll(OrderSearch orderSearch) {
 //... ê²€ìƒ‰ ë¡œì§
 }
}
~~~

### findAll(OrderSearch orderSearch)ë©”ì„œë“œê°€ ê²€ìƒ‰ ì¡°ê±´ì— ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•´ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œë‹¤.
<br>
<br>

## ğŸ‘€ JPQLë¡œ ì²˜ë¦¬
~~~java
public List<Order> findAllByString(OrderSearch orderSearch) {
 //language=JPAQL
 String jpql = "select o From Order o join o.member m";
 boolean isFirstCondition = true;
 //ì£¼ë¬¸ ìƒíƒœ ê²€ìƒ‰
 if (orderSearch.getOrderStatus() != null) {
 if (isFirstCondition) {
 jpql += " where";
 isFirstCondition = false;
 } else {
 jpql += " and";
 }
 jpql += " o.status = :status";
 }
 //íšŒì› ì´ë¦„ ê²€ìƒ‰
 if (StringUtils.hasText(orderSearch.getMemberName())) {
 if (isFirstCondition) {
 jpql += " where";
 isFirstCondition = false;
 } else {
 jpql += " and";
 }
 jpql += " m.name like :name";
 }
 TypedQuery<Order> query = em.createQuery(jpql, Order.class)
 .setMaxResults(1000); //ìµœëŒ€ 1000ê±´
 if (orderSearch.getOrderStatus() != null) {
 query = query.setParameter("status", orderSearch.getOrderStatus());
 }
 if (StringUtils.hasText(orderSearch.getMemberName())) {
 query = query.setParameter("name", orderSearch.getMemberName());
 }
 return query.getResultList();
}
~~~
<br>
<br>

## ğŸ‘€ JPA Criteriaë¡œ ì²˜ë¦¬
~~~java
public List<Order> findAllByCriteria(OrderSearch orderSearch) {
 CriteriaBuilder cb = em.getCriteriaBuilder();
 CriteriaQuery<Order> cq = cb.createQuery(Order.class);
 Root<Order> o = cq.from(Order.class);
 Join<Order, Member> m = o.join("member", JoinType.INNER); //íšŒì›ê³¼ ì¡°ì¸
 List<Predicate> criteria = new ArrayList<>();
 //ì£¼ë¬¸ ìƒíƒœ ê²€ìƒ‰
 if (orderSearch.getOrderStatus() != null) {
 Predicate status = cb.equal(o.get("status"),
orderSearch.getOrderStatus());
 criteria.add(status);
 }
 //íšŒì› ì´ë¦„ ê²€ìƒ‰
 if (StringUtils.hasText(orderSearch.getMemberName())) {
 Predicate name =
 cb.like(m.<String>get("name"), "%" +
orderSearch.getMemberName() + "%");
 criteria.add(name);
 }
 cq.where(cb.and(criteria.toArray(new Predicate[criteria.size()])));
 TypedQuery<Order> query = em.createQuery(cq).setMaxResults(1000); //ìµœëŒ€
1000ê±´
 return query.getResultList();
}
~~~
<br>
<br>
<br>

## ğŸ‘ì •ë¦¬
JPA ì—ì„œ  ë™ì  ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì´ JPQL,JPA Criteriaì™€ ê°™ì´ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì´ ìˆì§€ë§Œ ì´ ë‘ê°€ì§€ë°©ë²•ì€ ì—¬ëŸ¬ ë¬¸ì œì ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì´ ë–¨ì–´ì§€ë©° ë³µì¡í•˜ë‹¤ëŠ” ë‹¨ì ìœ¼ë¡œ ì´ì— ëŒ€í•œ í•´ê²°ì±…ìœ¼ë¡œ Querydslë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.

<br>
<br>
<br>
<br>

## REF
- https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-1/dashboard