# ëª©ì°¨
- ìƒí¼ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)
- ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
- ìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ
## êµ¬í˜„ê¸°ëŠ¥
- ìƒí’ˆ ë“±ë¡
- ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
- ìƒí’ˆ ìˆ˜ì •

## ìˆœì„œ
- ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ ì¶”ê°€)
- ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
- ìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ
- ìƒí’ˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê°œë°œ
<br>
<br>
<br>
<br>

# ğŸ“Œìƒí¼ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)
## ìƒí’ˆ ì—”í‹°í‹° ì½”ë“œ
~~~java
package jpabook.jpashop.domain.item;

import jpabook.jpashop.domain.Category;
import jpabook.jpashop.exception.NotEnoughStockException;
import lombok.Getter;
import lombok.Setter;

import javax.persistence.Entity;
import javax.persistence.*;
import java.util.ArrayList;
import java.util.List;

@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "dtype")
@Getter @Setter
public abstract class Item {

    @Id @GeneratedValue
    @Column(name = "item_id")
    private Long id;

    private String name;

    private int price;

    private int stockQuantity;

    @ManyToMany(mappedBy = "items")
    private List<Category> categories = new ArrayList<>();


    //+ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§//

    //stock ì¦ê°€
    public void addStock(int quantity){
        this.stockQuantity += quantity;
    }

    //stock ê°ì†Œ
    public void removeStock(int quantity){
        int restStock = this.stockQuantity - quantity;
        if (restStock< 0){
            throw new NotEnoughStockException("need more stock");
        }
        this.stockQuantity = restStock;
    }

}

~~~
## ì˜ˆì™¸ ì¶”ê°€
~~~java
package jpabook.jpashop.exception;

public class NotEnoughStockException extends RuntimeException{
    public NotEnoughStockException() {
        super();
    }

    public NotEnoughStockException(String message) {
        super(message);
    }

    public NotEnoughStockException(String message, Throwable cause) {
        super(message, cause);
    }

    public NotEnoughStockException(Throwable cause) {
        super(cause);
    }


}

~~~
## ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ì„
### addStock()
- íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ìˆ˜ë§Œí¼ ì¬ê³ ë¥¼ ëŠ˜ë¦°ë‹¤. ì´ ë©”ì„œë“œëŠ” ì¬ê³ ê°€ ì¦ê°€í•˜ê±°ë‚˜ ìƒí’ˆ ì£¼ë¬¸ì„ ì·¨ì†Œí•´ì„œ ì¬ê³ ë¥¼ ë‹¤ì‹œ ëŠ˜ë ¤ì•¼ í•  ë•Œ ì‚¬ìš©í•œë‹¤.
### removeStock()
- íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ìˆ˜ë§Œí¼ ì¬ê³ ë¥¼ ì¤„ì´ê³ , ë§Œì•½ ì¬ê³ ê°€ ë¶€ì¡±í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤. ì£¼ë¡œ ìƒí’ˆì„ ì£¼ë¬¸í•  ë•Œ ì‚¬ìš©í•œë‹¤.
<br>
<br>
<br>
<br>


# ğŸ“Œìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
## ìƒí’ˆë¦¬í¬ì§€í† ë¦¬
~~~java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.item.Item;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;
import java.util.List;

@Repository
@RequiredArgsConstructor

public class ItemRepository {

    private final EntityManager em;

    //ìƒí’ˆ ì €ì¥
    public void save(Item item){
        if(item.getId() == null){
            em.persist(item);
        }else{
            em.merge(item);
        }
    }
    //ìƒí¼ì¡°íšŒ
    public Item findOne(Long id){
        return em.find(Item.class, id);
    }
    //ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
    public List<Item> findAll(){
        return em.createQuery("select i from Item i",Item.class).getResultList();
    }

}

~~~
## ë©”ì„œë“œ ì„¤ëª…
### save()
- idê°€ ì—†ìœ¼ë©´ ì‹ ê·œë¡œ ë³´ê³  persist() ì‹¤í–‰
- id ê°€ ìˆìœ¼ë©´ ì´ë¯¸ ë°ì´í„°ë©”ì´ìŠ¤ì— ì €ì¥ëœ ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•œë‹¤ ë³´ê³ , merge()ë¥¼ ì‹¤í–‰í•œë‹¤.

<br>
<br>
<br>
<br>


# ğŸ“Œìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ
## ìƒí’ˆ ì„œë¹„ìŠ¤ ì½”ë“œ
~~~java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.item.Item;
import jpabook.jpashop.repository.ItemRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class ItemService {

    private final ItemRepository itemRepository;
  /*  public ItemService(ItemRepository itemRepository){
        this.itemRepository = itemRepository;
    }*/// @RequiredArgsConstructor ë¡œ ìƒì„±ì ìë™ìƒì„±

    @Transactional
    public void saveItem(Item item){
        itemRepository.save(item);
    }

    public List<Item> finItem(){
        return  itemRepository.findAll();
    }

    public Item findOne(Long itemId) {
        return  itemRepository.findOne(itemId);
    }
}

~~~

<br>
<br>
<br>
<br>

# REF
- https://www.inflearn.com/course/ORM-JPA-Basic#curriculum